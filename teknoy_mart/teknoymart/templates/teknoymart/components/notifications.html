<!-- Notification Bell Icon -->
<div class="notification-container">
  <button class="notification-bell" id="notificationBell">
    <svg class="bell-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor">
      <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
      <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
    </svg>
    <span class="notification-badge" id="notificationBadge">5</span>
  </button>
  
  <!-- Notification Dropdown -->
  <div class="notification-dropdown" id="notificationDropdown">
    <div class="notification-header">
      <h3>Notifications</h3>
      <button class="mark-all-read" id="markAllRead">Mark all as read</button>
    </div>
    
    <div class="notification-body">
      <!-- New Notifications -->
      <div class="notification-section">
        <div class="section-label">New</div>
        
        <div class="notification-item unread" data-id="1">
          <div class="notification-icon cart-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
            </svg>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              <strong>John Doe</strong> added <strong>Gaming Laptop RTX 3060</strong> to cart
            </p>
            <span class="notification-time">Just now</span>
          </div>
          <div class="unread-indicator"></div>
        </div>
        
        <div class="notification-item unread" data-id="2">
          <div class="notification-icon order-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M21 16v-2l-8-5V3.5c0-.83-.67-1.5-1.5-1.5S10 2.67 10 3.5V9l-8 5v2l8-2.5V19l-2 1.5V22l3.5-1 3.5 1v-1.5L13 19v-5.5l8 2.5z"/>
            </svg>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              Your order <strong>#TKM-12345</strong> has been shipped and will arrive in 2-3 days
            </p>
            <span class="notification-time">5 minutes ago</span>
          </div>
          <div class="unread-indicator"></div>
        </div>

        <div class="notification-item unread" data-id="3">
          <div class="notification-icon message-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 9h12v2H6V9zm8 5H6v-2h8v2zm4-6H6V6h12v2z"/>
            </svg>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              <strong>Jane Smith</strong> sent you a message about <strong>CIT-U Hoodie</strong>
            </p>
            <span class="notification-time">12 minutes ago</span>
          </div>
          <div class="unread-indicator"></div>
        </div>
      </div>
      
      <!-- Earlier Notifications -->
      <div class="notification-section">
        <div class="section-label">Earlier</div>
        
        <div class="notification-item" data-id="4">
          <div class="notification-icon promo-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20 6h-2.18c.11-.31.18-.65.18-1 0-1.66-1.34-3-3-3-1.05 0-1.96.54-2.5 1.35l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm11 15H4v-2h16v2zm0-5H4V8h5.08L7 10.83 8.62 12 11 8.76l1-1.36 1 1.36L15.38 12 17 10.83 14.92 8H20v6z"/>
            </svg>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              <strong>Flash Sale Alert!</strong> Get 20% off on all electronics. Limited time only!
            </p>
            <span class="notification-time">2 hours ago</span>
          </div>
        </div>
        
        <div class="notification-item" data-id="5">
          <div class="notification-icon wishlist-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
            </svg>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              <strong>Price Drop!</strong> Wireless Headphones from your wishlist is now ₱899 (was ₱1,299)
            </p>
            <span class="notification-time">5 hours ago</span>
          </div>
        </div>

        <div class="notification-item" data-id="6">
          <div class="notification-icon delivered-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M9 16.2L4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"/>
            </svg>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              Your order <strong>#TKM-12340</strong> has been delivered successfully
            </p>
            <span class="notification-time">Yesterday</span>
          </div>
        </div>
      </div>
      
      <!-- This Week -->
      <div class="notification-section">
        <div class="section-label">This Week</div>
        
        <div class="notification-item" data-id="7">
          <div class="notification-icon review-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
            </svg>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              Please rate your recent purchase: <strong>Scientific Calculator</strong>
            </p>
            <span class="notification-time">3 days ago</span>
          </div>
        </div>

        <div class="notification-item" data-id="8">
          <div class="notification-icon account-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
            </svg>
          </div>
          <div class="notification-content">
            <p class="notification-text">
              Your profile has been updated successfully
            </p>
            <span class="notification-time">5 days ago</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="notification-footer">
      <a href="/notifications/" class="view-all-notifications">View all notifications</a>
    </div>
  </div>
</div>

<style>
/* Notification Container */
.notification-container {
  position: relative;
  display: inline-block;
  margin-right: 15px;
}

.notification-bell {
  position: relative;
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.notification-bell:hover {
  background: rgba(139, 0, 0, 0.1);
}

.bell-icon {
  width: 24px;
  height: 24px;
  color: #333;
  stroke-width: 2;
}

.notification-badge {
  position: absolute;
  top: 4px;
  right: 4px;
  background: #8B0000;
  color: white;
  font-size: 0.65rem;
  font-weight: 700;
  padding: 2px 5px;
  border-radius: 10px;
  min-width: 18px;
  height: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  border: 2px solid white;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.notification-badge.hidden {
  display: none;
}

/* Notification Dropdown */
.notification-dropdown {
  position: absolute;
  top: calc(100% + 12px);
  right: -10px;
  width: 420px;
  max-height: 650px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  opacity: 0;
  visibility: hidden;
  transform: translateY(-15px) scale(0.95);
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  z-index: 9999;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

.notification-dropdown::before {
  content: '';
  position: absolute;
  top: -8px;
  right: 20px;
  width: 16px;
  height: 16px;
  background: white;
  transform: rotate(45deg);
  box-shadow: -2px -2px 5px rgba(0, 0, 0, 0.05);
}

.notification-dropdown.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0) scale(1);
}

/* Notification Header */
.notification-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 18px 20px;
  border-bottom: 1px solid #f0f0f0;
  background: linear-gradient(to bottom, #ffffff, #fafafa);
}

.notification-header h3 {
  font-size: 1.3rem;
  font-weight: 700;
  color: #333;
  margin: 0;
}

.mark-all-read {
  background: none;
  border: none;
  color: #8B0000;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  padding: 6px 12px;
  border-radius: 6px;
  transition: all 0.3s;
}

.mark-all-read:hover {
  background: #fff4f4;
  transform: scale(1.05);
}

/* Notification Body */
.notification-body {
  flex: 1;
  overflow-y: auto;
  padding: 8px 0;
  max-height: 480px;
}

.notification-body::-webkit-scrollbar {
  width: 8px;
}

.notification-body::-webkit-scrollbar-track {
  background: #f9f9f9;
  border-radius: 4px;
}

.notification-body::-webkit-scrollbar-thumb {
  background: #ddd;
  border-radius: 4px;
}

.notification-body::-webkit-scrollbar-thumb:hover {
  background: #bbb;
}

/* Notification Section */
.notification-section {
  margin-bottom: 8px;
}

.section-label {
  font-size: 0.72rem;
  font-weight: 800;
  color: #999;
  text-transform: uppercase;
  padding: 12px 20px 6px;
  letter-spacing: 0.8px;
  background: #fafafa;
  position: sticky;
  top: 0;
  z-index: 1;
}

/* Notification Item */
.notification-item {
  display: flex;
  align-items: flex-start;
  gap: 12px;
  padding: 12px 20px;
  cursor: pointer;
  transition: all 0.3s ease;
  position: relative;
  border-left: 3px solid transparent;
  background: white;
}

.notification-item:hover {
  background: #f9f9f9;
  border-left-color: #e0e0e0;
}

.notification-item.unread {
  background: linear-gradient(to right, #fff8f8, #ffffff);
  border-left-color: #8B0000;
}

.notification-item.unread:hover {
  background: linear-gradient(to right, #fff4f4, #fefefe);
}

/* Notification Icons */
.notification-icon {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  flex-shrink: 0;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.cart-icon {
  background: linear-gradient(135deg, #e3f2fd, #bbdefb);
  color: #1976d2;
}

.order-icon {
  background: linear-gradient(135deg, #f3e5f5, #e1bee7);
  color: #7b1fa2;
}

.promo-icon {
  background: linear-gradient(135deg, #fff3e0, #ffe0b2);
  color: #f57c00;
}

.wishlist-icon {
  background: linear-gradient(135deg, #fce4ec, #f8bbd0);
  color: #c2185b;
}

.review-icon {
  background: linear-gradient(135deg, #fff9c4, #fff59d);
  color: #f9a825;
}

.message-icon {
  background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
  color: #388e3c;
}

.delivered-icon {
  background: linear-gradient(135deg, #e0f2f1, #b2dfdb);
  color: #00897b;
}

.account-icon {
  background: linear-gradient(135deg, #ede7f6, #d1c4e9);
  color: #5e35b1;
}

/* Notification Content */
.notification-content {
  flex: 1;
  min-width: 0;
}

.notification-text {
  font-size: 0.9rem;
  line-height: 1.5;
  color: #333;
  margin: 0 0 6px;
}

.notification-text strong {
  font-weight: 700;
  color: #8B0000;
}

.notification-time {
  font-size: 0.75rem;
  color: #999;
  font-weight: 500;
}

/* Unread Indicator */
.unread-indicator {
  width: 10px;
  height: 10px;
  background: #8B0000;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 8px;
  box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.2);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% {
    box-shadow: 0 0 0 3px rgba(139, 0, 0, 0.2);
  }
  50% {
    box-shadow: 0 0 0 6px rgba(139, 0, 0, 0.1);
  }
}

/* Notification Footer */
.notification-footer {
  padding: 12px 20px;
  border-top: 1px solid #f0f0f0;
  text-align: center;
  background: #fafafa;
}

.view-all-notifications {
  color: #8B0000;
  text-decoration: none;
  font-weight: 700;
  font-size: 0.9rem;
  transition: all 0.3s;
  display: inline-block;
  padding: 8px 16px;
  border-radius: 8px;
}

.view-all-notifications:hover {
  background: white;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  transform: translateY(-2px);
}

/* Empty State */
.notification-empty {
  text-align: center;
  padding: 60px 20px;
}

.notification-empty-icon {
  font-size: 3.5rem;
  opacity: 0.3;
  margin-bottom: 15px;
}

.notification-empty p {
  color: #999;
  font-size: 0.95rem;
  line-height: 1.6;
}

/* Animations */
@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.notification-item {
  animation: slideDown 0.3s ease;
}

/* Responsive */
@media (max-width: 768px) {
  .notification-dropdown {
    width: 95vw;
    max-width: 400px;
    right: -50px;
  }

  .notification-dropdown::before {
    right: 60px;
  }
}

/* Dark mode support */
body.dark-mode .notification-bell:hover {
  background: rgba(255, 255, 255, 0.1);
}

body.dark-mode .bell-icon {
  color: #fff;
}

body.dark-mode .notification-dropdown {
  background: #2c2c2c;
  box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

body.dark-mode .notification-dropdown::before {
  background: #2c2c2c;
}

body.dark-mode .notification-header {
  background: linear-gradient(to bottom, #2c2c2c, #242424);
  border-bottom-color: #444;
}

body.dark-mode .notification-header h3 {
  color: #fff;
}

body.dark-mode .section-label {
  background: #242424;
  color: #999;
}

body.dark-mode .notification-item {
  background: #2c2c2c;
}

body.dark-mode .notification-item:hover {
  background: #333;
}

body.dark-mode .notification-item.unread {
  background: linear-gradient(to right, #3a1f1f, #2c2c2c);
}

body.dark-mode .notification-text {
  color: #ddd;
}

body.dark-mode .notification-footer {
  background: #242424;
  border-top-color: #444;
}

body.dark-mode .view-all-notifications:hover {
  background: #333;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // CSRF Token helper
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
      const cookies = document.cookie.split(';');
      for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.substring(0, name.length + 1) === (name + '=')) {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }
  const csrftoken = getCookie('csrftoken');

  // Notification Toggle
  const notificationBell = document.getElementById('notificationBell');
  const notificationDropdown = document.getElementById('notificationDropdown');
  const notificationBadge = document.getElementById('notificationBadge');
  const markAllReadBtn = document.getElementById('markAllRead');

  // Toggle notification dropdown
  notificationBell?.addEventListener('click', function(e) {
    e.stopPropagation();
    notificationDropdown.classList.toggle('show');
    
    // Add animation to notification items
    if (notificationDropdown.classList.contains('show')) {
      const items = notificationDropdown.querySelectorAll('.notification-item');
      items.forEach((item, index) => {
        item.style.animationDelay = `${index * 0.05}s`;
      });
    }
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (!notificationDropdown?.contains(e.target) && 
        !notificationBell?.contains(e.target)) {
      notificationDropdown?.classList.remove('show');
    }
  });

  // Mark single notification as read
  document.querySelectorAll('.notification-item').forEach(item => {
    item.addEventListener('click', function(e) {
      e.stopPropagation();
      const notificationId = this.dataset.id;
      
      if (this.classList.contains('unread')) {
        // Send AJAX request to mark as read
        fetch(`/notifications/mark-read/${notificationId}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken,
            'Content-Type': 'application/json'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            this.classList.remove('unread');
            updateNotificationBadge();
          }
        })
        .catch(error => console.error('Error:', error));
      }
    });
  });

  // Mark all as read
  markAllReadBtn?.addEventListener('click', function(e) {
    e.stopPropagation();
    
    fetch('/notifications/mark-all-read/', {
      method: 'POST',
      headers: {
        'X-CSRFToken': csrftoken,
        'Content-Type': 'application/json'
      }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        document.querySelectorAll('.notification-item.unread').forEach(item => {
          item.classList.remove('unread');
        });
        notificationBadge.classList.add('hidden');
        
        // Show success feedback
        this.textContent = '✓ Marked all as read';
        setTimeout(() => {
          this.textContent = 'Mark all as read';
        }, 2000);
      }
    })
    .catch(error => console.error('Error:', error));
  });

  // Update notification badge count
  function updateNotificationBadge() {
    const unreadCount = document.querySelectorAll('.notification-item.unread').length;
    if (unreadCount > 0) {
      notificationBadge.textContent = unreadCount > 9 ? '9+' : unreadCount;
      notificationBadge.classList.remove('hidden');
    } else {
      notificationBadge.classList.add('hidden');
    }
  }

  // Initialize badge count
  updateNotificationBadge();

  // Real-time notification polling (check every 30 seconds)
  setInterval(function() {
    fetch('/notifications/get-new/')
      .then(response => response.json())
      .then(data => {
        if (data.has_new) {
          updateNotificationBadge();
          // Optional: Add a subtle animation to the bell
          notificationBell.classList.add('shake');
          setTimeout(() => {
            notificationBell.classList.remove('shake');
          }, 500);
        }
      })
      .catch(error => console.error('Error:', error));
  }, 30000);

  // Add shake animation
  const style = document.createElement('style');
  style.textContent = `
    @keyframes shake {
      0%, 100% { transform: rotate(0deg); }
      25% { transform: rotate(-15deg); }
      75% { transform: rotate(15deg); }
    }
    .notification-bell.shake {
      animation: shake 0.5s ease;
    }
  `;
  document.head.appendChild(style);
});
</script>