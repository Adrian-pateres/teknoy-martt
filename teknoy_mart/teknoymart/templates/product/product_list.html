{% extends "teknoymart/base.html" %}
{% load static %}

{% block title %}My Products | Teknoy Mart{% endblock %}
{% block body_class %}product-list-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_list.css' %}">
{% endblock %}

{% block content %}
<main class="product-list-shell">

  <!-- Header -->
  <div class="product-list-header">
    <h2>ðŸ›’ My Uploaded Products</h2>
    <a href="{% url 'add_product' %}" class="btn btn-primary">Add Product</a>
  </div>

  <!-- Flash messages -->
  {% if messages %}
    <div class="flash">
      {% for message in messages %}
        <div class="flash-msg {{ message.tags }}">{{ message }}</div>
      {% endfor %}
    </div>
  {% endif %}

  {% if products %}
    <!-- Product Grid -->
    <div class="product-list-grid">
      {% for product in products %}
      <article class="product-card">
        <div class="thumb">
          {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.title }}">
          {% else %}
            <img src="{% static 'images/noimage.png' %}" alt="No image available">
          {% endif %}
        </div>

        <div class="details">
          <h3>{{ product.title }}</h3>
          <p class="category">{{ product.category }}</p>
          <p class="price">â‚±{{ product.price }}</p>
        </div>

        <div class="actions">
          <a class="btn btn-sm btn-primary" href="{% url 'edit_product' product.pk %}">Edit</a>

          <!-- Delete button triggers modal -->
          <button 
            type="button" 
            class="btn btn-sm btn-danger"
            onclick="openDeleteModal('{{ product.pk }}', '{{ product.title }}')">
            Delete
          </button>

          <!-- Hidden form for deletion -->
          <form id="delete-form-{{ product.pk }}" action="{% url 'delete_product' product.pk %}" method="post" style="display:none;">
            {% csrf_token %}
          </form>
        </div>
      </article>
      {% endfor %}
    </div>
  {% else %}
    <p class="no-products">You havenâ€™t uploaded any products yet.</p>
  {% endif %}

  <!-- Footer -->
  <div class="product-list-footer">
    <a href="{% url 'home' %}" class="btn btn-secondary">Home</a>
    <a href="{% url 'logout' %}" class="btn btn-secondary">Logout</a>
  </div>
</main>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <h3 id="modal-text">Are you sure you want to delete this product?</h3>
    <div class="modal-actions">
      <button class="btn btn-danger" id="confirmDelete">Yes, Delete</button>
      <button class="btn btn-cancel" onclick="closeDeleteModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Script -->
<script>
  let productToDelete = null;

  function openDeleteModal(productId, title) {
    productToDelete = productId;
    document.getElementById('modal-text').innerText =
      `Are you sure you want to delete "${title}"?`;
    document.getElementById('deleteModal').style.display = 'flex';
  }

  function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
    productToDelete = null;
  }

  document.getElementById('confirmDelete').addEventListener('click', function () {
    if (productToDelete) {
      const form = document.getElementById(`delete-form-${productToDelete}`);
      if (form) form.submit();
    }
    closeDeleteModal();
  });

  // Close modal when clicking outside
  window.addEventListener('click', function (e) {
    const modal = document.getElementById('deleteModal');
    if (e.target === modal) closeDeleteModal();
  });
</script>

<<<<<<< HEAD
{% endblock %}
=======
{% endblock %}
>>>>>>> b05a911db3601e37ff8ac75905f33203cb8184fc
