{% extends "teknoymart/base.html" %}
{% load static %}

{% block content %}
<div class="chat-container">
  <div class="chat-header">
    <div class="header-content">
        {% if request.user.profile.role == 'seller' %}
            <a href="{% url 'home' %}" class="back-link">‚Üê Dashboard</a>
        {% else %}
            <a href="{% url 'home_buyer' %}" class="back-link">‚Üê Home</a>
        {% endif %}

        <h2>üí¨ Messages</h2>
        
        <div style="width: 80px;"></div> 
    </div>
  </div>

  <div class="inbox-list">
    {% for convo in conversations %}
      <a href="{% url 'chat_room' convo.user.id %}" class="inbox-item">
        <div class="avatar-circle">
          {% if convo.user.profile.profile_picture %}
            <img src="{{ convo.user.profile.profile_picture.url }}" alt="Pic">
          {% else %}
            <span>{{ convo.user.first_name|first }}</span>
          {% endif %}
        </div>
        <div class="inbox-details">
          <h4>{{ convo.user.first_name }} {{ convo.user.last_name }} <span class="role-badge">{{ convo.user.profile.role|title }}</span></h4>
          <p class="preview">{{ convo.last_message.body|truncatechars:30 }}</p>
        </div>
        <div class="inbox-time">
          {{ convo.last_message.timestamp|date:"M d" }}
        </div>
      </a>
    {% empty %}
      <div class="empty-state">
        <p>No messages yet.</p>
        {% if request.user.profile.role == 'buyer' %}
            <a href="{% url 'home_buyer' %}" class="btn btn-primary">Browse Shop</a>
        {% else %}
            <p>Wait for buyers to contact you!</p>
            <a href="{% url 'home' %}" class="btn btn-primary">Back to Dashboard</a>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>

<style>
  .chat-container { max-width: 600px; margin: 2rem auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); overflow: hidden; }
  
  .chat-header { background: #8B0000; color: white; padding: 15px; }
  .header-content { display: flex; justify-content: space-between; align-items: center; }
  .header-content h2 { margin: 0; font-size: 1.2rem; }
  .back-link { color: white; text-decoration: none; font-weight: bold; font-size: 0.9rem; width: 80px; }
  .back-link:hover { text-decoration: underline; }

  .inbox-list { display: flex; flex-direction: column; }
  .inbox-item { display: flex; align-items: center; padding: 15px; border-bottom: 1px solid #eee; text-decoration: none; color: #333; transition: background 0.2s; }
  .inbox-item:hover { background: #f9f9f9; }
  .avatar-circle { width: 50px; height: 50px; background: #eee; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; margin-right: 15px; font-weight: bold; font-size: 1.2rem; color: #555; }
  .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }
  .inbox-details { flex: 1; }
  .inbox-details h4 { margin: 0 0 5px 0; font-size: 1rem; }
  .preview { margin: 0; color: #777; font-size: 0.9rem; }
  .role-badge { font-size: 0.7rem; background: #ddd; padding: 2px 6px; border-radius: 4px; margin-left: 5px; color: #555; vertical-align: middle; }
  .inbox-time { font-size: 0.8rem; color: #999; }
  .empty-state { padding: 40px; text-align: center; color: #666; }
  
  body.dark-mode .chat-container { background: #1e1e1e; border: 1px solid #333; }
  body.dark-mode .inbox-item { border-bottom-color: #333; color: #e0e0e0; }
  body.dark-mode .inbox-item:hover { background: #2d2d2d; }
  body.dark-mode .preview { color: #aaa; }
</style>
{% endblock %}