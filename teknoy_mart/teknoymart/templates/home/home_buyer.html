{% extends "teknoymart/base.html" %}
{% load static %}

{% block title %}Home | Teknoy Mart{% endblock %}
{% block body_class %}home-page{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
{% endblock %}  
{% block navbar %}
<header class="navbar">
  <div class="logo-text">
    <img src="{% static 'images/logo.png' %}" alt="Teknoy Mart Logo" class="navbar-logo">
    <span>Teknoy Mart</span>
  </div>
  <nav class="top-actions">
  <a href="{% url 'profile' %}">Profile</a>

  <!-- Hamburger menu -->
  <div class="menu-wrap">
    <button id="hamburgerBtn" class="hamburger"
            aria-haspopup="true" aria-expanded="false" aria-controls="userMenu"
            title="Menu">
      <span></span><span></span><span></span>
    </button>

    <div id="userMenu" class="dropdown-menu" role="menu">
      <a role="menuitem" href="{% url 'about' %}">About</a>
      <a role="menuitem" href="{% url 'buyer_preferences' %}">Preferences</a>
      <a role="menuitem" href="{% url 'buyer_privacy_settings' %}">Privacy</a>
      <a role="menuitem" href="javascript:void(0);" style="cursor: default; opacity: 0.6;">Transaction History</a>

      <button role="menuitem" type="button" id="menu-dark" class="menu-item-btn">
        üåô Dark Mode
      </button>

      <a role="menuitem" href="{% url 'buyer_terms' %}">Terms</a>
      <a href="{% url 'buyer_delete_account' %}">Delete Account</a>

      <a href="{% url 'logout_confirm' %}">Logout</a>
    </div>
  </div>
</nav>
</header>

<main class="home-shell">

</div>  <!-- üîç Search Bar -->
  <div class="home-row search-bar">
    <input id="productSearch" type="text" placeholder="Search products, categories..." aria-label="Search">
    <button type="button" aria-label="Search">üîç</button>
  </div>

  <!-- üß≠ Tabs -->
  <div class="home-row tabs">
    <a href="#" class="tab-link active" data-tab="shop">Shop</a>
    <a href="#" class="tab-link" data-tab="categories">Categories</a>
  </div>

  <!-- üè™ SHOP VIEW -->
  <section id="shop-view" class="tab-view active-view">
    <!-- Category chips -->
    <div class="home-row cat-filter" role="tablist" aria-label="Filter by category">
  <button class="chip active" data-cat="all">All</button>
  <button class="chip" data-cat="clothing">Clothing</button>
  <button class="chip" data-cat="electronics">Electronics</button>
  <button class="chip" data-cat="food">Food</button>
  <button class="chip" data-cat="accessories">Accessories</button>
</div>

    <!-- Latest Products -->
    <section class="home-row product-section">
  <div class="section-head">
    <h3>üõí Latest Products</h3>
    <a href="#" class="view-all">View all</a>
  </div>

  <div class="product-grid">
    {% for product in products %}
      <article class="product-card"
               data-cat="{{ product.category|lower }}"
               data-name="{{ product.title|lower }}">
        <div class="thumb">
          {% if product.image %}
            <img src="{{ product.image.url }}" alt="{{ product.title }}">
          {% else %}
            <img src="{% static 'images/noimage.png' %}" alt="No image available">
          {% endif %}
        </div>
        <div class="meta">
          <p class="title">{{ product.title }}</p>
          <p class="price">‚Ç±{{ product.price }}</p>
          <a href="{% url 'buy_now' product.id %}"
             class="btn btn-primary"
             style="text-decoration: none;">Buy Now</a>
        </div>
      </article>
    {% empty %}
      <p>No products yet.</p>
    {% endfor %}
  </div>
</section>

    <!-- Banner -->
    <div class="home-row promo-banner">
      <img src="{% static 'images/promobanner.png' %}" alt="Promo Banner">
    </div>
  </section>

  <!-- üìÇ CATEGORIES VIEW -->
  <section id="categories-view" class="tab-view">
    <div class="home-row">
      {% regroup products by category as category_list %}
      {% for group in category_list %}
      <div class="category-block">
        <div class="category-title">
          <h3>üìÇ {{ group.grouper }}</h3>
        </div>

        <div class="category-slider-wrapper">
          <button class="side-btn prev" aria-label="Previous">&#10094;</button>

          <div class="category-slider">
            {% for product in group.list %}
            <article class="product-card small">
              <div class="thumb">
                {% if product.image %}
                  <img src="{{ product.image.url }}" alt="{{ product.title }}">
                {% else %}
                  <img src="{% static 'images/noimage.png' %}" alt="No image available">
                {% endif %}
              </div>
              <div class="meta">
                <p class="title">{{ product.title }}</p>
                <p class="price">‚Ç±{{ product.price }}</p>
              </div>
            </article>
            {% endfor %}
          </div>

          <button class="side-btn next" aria-label="Next">&#10095;</button>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>

</main>

<!-- ‚öôÔ∏è JS: Tabs + Slider -->
<script>
  // Tab Switching
  const tabLinks = document.querySelectorAll(".tab-link");
  const tabViews = document.querySelectorAll(".tab-view");

  tabLinks.forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();

      tabLinks.forEach(l => l.classList.remove("active"));
      tabViews.forEach(v => v.classList.remove("active-view"));

      link.classList.add("active");
      document.getElementById(`${link.dataset.tab}-view`).classList.add("active-view");
    });
  });

  // Category Sliders
  document.querySelectorAll(".category-block").forEach(block => {
    const slider = block.querySelector(".category-slider");
    const prev = block.querySelector(".side-btn.prev");
    const next = block.querySelector(".side-btn.next");

    prev.addEventListener("click", () => {
      slider.scrollBy({ left: -300, behavior: "smooth" });
    });

    next.addEventListener("click", () => {
      slider.scrollBy({ left: 300, behavior: "smooth" });
    });
  });
</script>

{% endblock %}
